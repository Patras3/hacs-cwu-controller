<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CWU Controller</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css?v=9.1.0">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <div class="header-icon-wrapper">
                    <span class="mdi mdi-water-boiler"></span>
                    <div class="icon-pulse"></div>
                </div>
                <div>
                    <h1>CWU Controller</h1>
                    <p class="header-subtitle">Smart Heat Pump Management</p>
                </div>
            </div>
            <div class="header-status">
                <div class="status-badge" id="controller-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Loading...</span>
                </div>
                <label class="toggle-switch" title="Enable/Disable Controller">
                    <input type="checkbox" id="controller-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <button class="btn btn-icon" onclick="refreshData()" title="Refresh Data">
                    <span class="mdi mdi-refresh"></span>
                </button>
            </div>
        </header>

        <!-- System Visualization Card (Holographic) - MOBILE VERSION -->
        <div class="system-viz-card system-viz-mobile" id="system-viz-card">
            <svg viewBox="0 -15 480 330" id="system-viz-svg">
                <defs>
                    <linearGradient id="vizHelixGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#FF5533"/>
                        <stop offset="30%" stop-color="#FF7744"/>
                        <stop offset="50%" stop-color="#DDAA44"/>
                        <stop offset="70%" stop-color="#44AADD"/>
                        <stop offset="100%" stop-color="#0088FF"/>
                    </linearGradient>
                    <linearGradient id="vizWaterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#FF5533" stop-opacity="0.3"/>
                        <stop offset="40%" stop-color="#CC8844" stop-opacity="0.2"/>
                        <stop offset="70%" stop-color="#44AADD" stop-opacity="0.2"/>
                        <stop offset="100%" stop-color="#0066FF" stop-opacity="0.3"/>
                    </linearGradient>
                </defs>

                <!-- HEAT PUMP -->
                <g transform="translate(15, 45)">
                    <rect class="viz-w viz-f viz-glow" x="0" y="0" width="130" height="85" rx="3"/>
                    <rect class="viz-w-dim viz-f" x="3" y="3" width="75" height="79" rx="2"/>
                    <circle class="viz-w viz-glow-s" cx="40" cy="42" r="34"/>
                    <circle class="viz-w-dim viz-pulse" cx="40" cy="42" r="38" stroke-dasharray="5 3"/>
                    <circle class="viz-w-dim" cx="40" cy="42" r="30" stroke-dasharray="3 3" style="opacity:0.25"/>
                    <g class="viz-fan viz-glow-s" id="viz-fan" style="transform-origin: 40px 42px;">
                        <path class="viz-blade-fill" d="M40,42 L37,32 Q28,14 38,4 Q48,3 52,12 Q54,26 44,38 Z"/>
                        <path class="viz-blade-fill" d="M40,42 L50,39 Q68,30 78,40 Q78,50 68,54 Q52,55 44,45 Z"/>
                        <path class="viz-blade-fill" d="M40,42 L43,52 Q52,70 42,80 Q32,81 28,72 Q26,56 36,46 Z"/>
                        <path class="viz-blade-fill" d="M40,42 L30,45 Q12,54 2,44 Q2,34 12,30 Q28,29 36,39 Z"/>
                        <circle cx="40" cy="42" r="10" fill="rgba(0,12,24,0.95)" class="viz-w viz-glow"/>
                        <circle cx="40" cy="42" r="6" fill="rgba(0,30,50,0.9)" class="viz-w"/>
                        <circle cx="40" cy="42" r="2.5" fill="#00FFFF" class="viz-glow-s"/>
                    </g>
                    <g transform="translate(105, 42)" id="viz-power-group">
                        <rect class="viz-power-badge" x="-26" y="-18" width="52" height="36" rx="4"/>
                        <text class="viz-power-value" id="viz-power-value" x="0" y="2" text-anchor="middle">--</text>
                        <text class="viz-power-unit" id="viz-power-unit" x="0" y="14" text-anchor="middle">W</text>
                    </g>
                    <g class="viz-defrost-indicator" id="viz-defrost-indicator" transform="translate(40, 42)">
                        <circle cx="0" cy="0" r="38" fill="rgba(136,221,255,0.08)" class="viz-defrost-icon"/>
                        <g class="viz-defrost-icon" transform="scale(1.8)">
                            <line x1="0" y1="-12" x2="0" y2="12" stroke="#88DDFF" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="-10" y1="-6" x2="10" y2="6" stroke="#88DDFF" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="-10" y1="6" x2="10" y2="-6" stroke="#88DDFF" stroke-width="2.5" stroke-linecap="round"/>
                            <line x1="0" y1="-12" x2="-4" y2="-8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                            <line x1="0" y1="-12" x2="4" y2="-8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                            <line x1="0" y1="12" x2="-4" y2="8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                            <line x1="0" y1="12" x2="4" y2="8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                            <line x1="-10" y1="-6" x2="-7" y2="-9" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                            <line x1="10" y1="6" x2="7" y2="9" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                        </g>
                    </g>
                    <g class="viz-defrost-indicator" id="viz-defrost-label" transform="translate(40, 98)">
                        <rect x="-32" y="-8" width="64" height="16" rx="3" fill="rgba(136,221,255,0.15)" stroke="#88DDFF" stroke-width="1"/>
                        <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:10px;font-weight:600;fill:#88DDFF;letter-spacing:2px;">DEFROST</text>
                    </g>
                    <rect class="viz-w viz-glow" x="10" y="85" width="25" height="6" rx="1"/>
                    <rect class="viz-w viz-glow" x="95" y="85" width="25" height="6" rx="1"/>
                    <circle class="viz-conn-hot" cx="130" cy="20" r="6"/>
                    <circle class="viz-conn-cold" cx="130" cy="70" r="6"/>
                </g>

                <!-- CWU TANK -->
                <g class="viz-tank-view" id="viz-tank-group" transform="translate(310, -5)">
                    <ellipse class="viz-w-dim viz-pulse" cx="60" cy="15" rx="48" ry="12"/>
                    <line class="viz-w-bright" x1="12" y1="15" x2="12" y2="215"/>
                    <line class="viz-w-bright" x1="108" y1="15" x2="108" y2="215"/>
                    <ellipse class="viz-w-bright" cx="60" cy="215" rx="48" ry="12"/>
                    <clipPath id="vizTankClip"><path d="M14,28 L14,215 A48,12 0 0,0 106,215 L106,28 A48,12 0 0,1 14,28"/></clipPath>
                    <rect x="12" y="28" width="96" height="200" fill="url(#vizWaterGrad)" clip-path="url(#vizTankClip)"/>
                    <path class="viz-helix viz-helix-back" d="M22,35 C22,43 98,43 98,51 C98,59 22,59 22,67 C22,75 98,75 98,83 C98,91 22,91 22,99 C22,107 98,107 98,115 C98,123 22,123 22,131 C22,139 98,139 98,147 C98,155 22,155 22,163 C22,171 98,171 98,179 C98,187 22,187 22,195"/>
                    <path class="viz-helix viz-helix-front viz-helix-flow" d="M22,35 C22,43 98,43 98,51 C98,59 22,59 22,67 C22,75 98,75 98,83 C98,91 22,91 22,99 C22,107 98,107 98,115 C98,123 22,123 22,131 C22,139 98,139 98,147 C98,155 22,155 22,163 C22,171 98,171 98,179 C98,187 22,187 22,195"/>
                    <g transform="translate(60, 5)">
                        <rect class="viz-target-badge" x="-32" y="-12" width="64" height="28" rx="4"/>
                        <text class="viz-target-label" x="0" y="-3" text-anchor="middle">TARGET</text>
                        <text class="viz-target-value" id="viz-target-temp" x="0" y="11" text-anchor="middle">--°C</text>
                    </g>
                    <g transform="translate(60, 155)">
                        <rect class="viz-temp-badge" x="-42" y="-18" width="84" height="38" rx="5"/>
                        <text class="viz-temp-badge-value" id="viz-cwu-temp" x="0" y="7" text-anchor="middle">--°</text>
                    </g>
                    <text class="viz-label" x="60" y="248" text-anchor="middle">CWU</text>
                    <!-- Electric heater indicator -->
                    <g class="viz-heater-indicator" id="viz-cwu-heater-indicator" transform="translate(60, 228)">
                        <rect x="-28" y="-8" width="56" height="16" rx="3" fill="rgba(255,136,0,0.15)" stroke="#FF8800" stroke-width="1"/>
                        <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#FF8800;letter-spacing:1px;">⚡ HEATER</text>
                    </g>
                    <!-- Compressor indicator -->
                    <g class="viz-compressor-indicator" id="viz-cwu-compressor-indicator" transform="translate(60, 210)">
                        <rect x="-32" y="-8" width="64" height="16" rx="3" fill="rgba(0,200,255,0.15)" stroke="#00C8FF" stroke-width="1"/>
                        <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#00C8FF;letter-spacing:1px;">❄ COMPRESSOR</text>
                    </g>
                </g>

                <!-- Pipes to tank -->
                <g class="viz-tank-view" id="viz-tank-pipes">
                    <path class="viz-pipe-hot viz-pipe-flow" d="M145,65 L200,65 L200,30 L332,30"/>
                    <rect x="195" y="-2" width="52" height="24" rx="4" fill="rgba(255,85,51,0.2)" stroke="var(--viz-hot)" stroke-width="1.5"/>
                    <text class="viz-flow-badge" id="viz-flow-temp-cwu" x="221" y="16" text-anchor="middle" fill="var(--viz-hot)">--°</text>
                    <path class="viz-pipe-cold viz-pipe-flow" d="M332,190 L200,190 L200,115 L145,115"/>
                    <rect x="195" y="196" width="52" height="24" rx="4" fill="rgba(0,136,255,0.2)" stroke="var(--viz-cold)" stroke-width="1.5"/>
                    <text class="viz-return-badge" id="viz-return-temp-cwu" x="221" y="214" text-anchor="middle" fill="var(--viz-cold)">--°</text>
                </g>

                <!-- Delta T (CWU) -->
                <g class="viz-tank-view viz-delta-badge" transform="translate(185, 90)">
                    <rect x="-28" y="-14" width="56" height="30" rx="5" fill="rgba(0,255,255,0.15)" stroke="var(--viz-cyan)" stroke-width="1.5"/>
                    <text x="0" y="-4" text-anchor="middle" style="font-family:'IBM Plex Mono',monospace;font-size:9px; fill:rgba(0,255,255,0.9);">ΔT</text>
                    <text id="viz-delta-cwu" x="0" y="11" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:15px;font-weight:700; fill:var(--viz-cyan);">--°</text>
                </g>

                <!-- FLOOR HEATING -->
                <g class="viz-floor-view" id="viz-floor-group" transform="translate(260, 15)">
                    <rect class="viz-floor-surface" x="10" y="10" width="180" height="145" rx="4"/>
                    <path class="viz-floor-pipe viz-fp-hot viz-pipe-flow" d="M20,24 L180,24"/>
                    <path class="viz-floor-pipe viz-fp-hot viz-pipe-flow" d="M180,24 L180,40"/>
                    <path class="viz-floor-pipe viz-fp-w1 viz-pipe-flow" d="M180,40 L30,40"/>
                    <path class="viz-floor-pipe viz-fp-w1 viz-pipe-flow" d="M30,40 L30,56"/>
                    <path class="viz-floor-pipe viz-fp-w2 viz-pipe-flow" d="M30,56 L180,56"/>
                    <path class="viz-floor-pipe viz-fp-w2 viz-pipe-flow" d="M180,56 L180,72"/>
                    <path class="viz-floor-pipe viz-fp-w3 viz-pipe-flow" d="M180,72 L30,72"/>
                    <path class="viz-floor-pipe viz-fp-w3 viz-pipe-flow" d="M30,72 L30,88"/>
                    <path class="viz-floor-pipe viz-fp-c1 viz-pipe-flow" d="M30,88 L180,88"/>
                    <path class="viz-floor-pipe viz-fp-c1 viz-pipe-flow" d="M180,88 L180,104"/>
                    <path class="viz-floor-pipe viz-fp-c2 viz-pipe-flow" d="M180,104 L30,104"/>
                    <path class="viz-floor-pipe viz-fp-c2 viz-pipe-flow" d="M30,104 L30,120"/>
                    <path class="viz-floor-pipe viz-fp-c3 viz-pipe-flow" d="M30,120 L180,120"/>
                    <path class="viz-floor-pipe viz-fp-c3 viz-pipe-flow" d="M180,120 L180,136"/>
                    <path class="viz-floor-pipe viz-fp-cold viz-pipe-flow" d="M180,136 L30,136"/>
                    <path class="viz-floor-pipe viz-fp-cold viz-pipe-flow" d="M30,136 L30,145 L20,145"/>
                    <circle class="viz-conn-hot" cx="20" cy="24" r="5"/>
                    <circle class="viz-conn-cold" cx="20" cy="145" r="5"/>
                    <text class="viz-label" x="100" y="168" text-anchor="middle" style="font-size:9px; letter-spacing:2px;">PODŁOGOWE</text>
                    <!-- Electric heater indicator -->
                    <g class="viz-heater-indicator" id="viz-floor-heater-indicator" transform="translate(100, 182)">
                        <rect x="-28" y="-8" width="56" height="16" rx="3" fill="rgba(255,136,0,0.15)" stroke="#FF8800" stroke-width="1"/>
                        <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#FF8800;letter-spacing:1px;">⚡ HEATER</text>
                    </g>
                    <!-- Compressor indicator -->
                    <g class="viz-compressor-indicator" id="viz-floor-compressor-indicator" transform="translate(100, 198)">
                        <rect x="-32" y="-8" width="64" height="16" rx="3" fill="rgba(0,200,255,0.15)" stroke="#00C8FF" stroke-width="1"/>
                        <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#00C8FF;letter-spacing:1px;">❄ COMPRESSOR</text>
                    </g>
                </g>

                <!-- Pipes to floor -->
                <g class="viz-floor-view" id="viz-floor-pipes">
                    <path class="viz-pipe-hot viz-pipe-flow" d="M145,65 L200,65 L200,39 L280,39"/>
                    <rect x="200" y="15" width="42" height="18" rx="3" fill="rgba(255,85,51,0.15)" stroke="var(--viz-hot)" stroke-width="1"/>
                    <text class="viz-flow-badge" id="viz-flow-temp-floor" x="221" y="29" text-anchor="middle" fill="var(--viz-hot)">--°</text>
                    <path class="viz-pipe-cold viz-pipe-flow" d="M280,160 L220,160 L220,115 L145,115"/>
                    <rect x="215" y="168" width="42" height="18" rx="3" fill="rgba(0,136,255,0.15)" stroke="var(--viz-cold)" stroke-width="1"/>
                    <text class="viz-return-badge" id="viz-return-temp-floor" x="236" y="182" text-anchor="middle" fill="var(--viz-cold)">--°</text>
                </g>

                <!-- Delta T (Floor) -->
                <g class="viz-floor-view viz-delta-badge" transform="translate(185, 90)">
                    <rect x="-28" y="-14" width="56" height="30" rx="5" fill="rgba(0,255,255,0.15)" stroke="var(--viz-cyan)" stroke-width="1.5"/>
                    <text x="0" y="-4" text-anchor="middle" style="font-family:'IBM Plex Mono',monospace;font-size:9px; fill:rgba(0,255,255,0.9);">ΔT</text>
                    <text id="viz-delta-floor" x="0" y="11" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:15px;font-weight:700; fill:var(--viz-cyan);">--°</text>
                </g>

                <!-- Status section -->
                <g transform="translate(15, 250)">
                    <rect x="-8" y="-16" width="320" height="52" rx="6" fill="rgba(0,20,40,0.8)" stroke="rgba(0,255,255,0.2)" stroke-width="1"/>
                    <g class="viz-tank-view">
                        <text x="0" y="0" style="font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;fill:var(--viz-hot);letter-spacing:2px;">DHW:</text>
                        <text id="viz-dhw-status" x="55" y="0" style="font-family:'IBM Plex Mono',monospace;font-size:11px;fill:rgba(0,255,255,0.9);">---</text>
                    </g>
                    <g class="viz-floor-view">
                        <text x="0" y="0" style="font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;fill:var(--viz-warm1);letter-spacing:2px;">HC1:</text>
                        <text id="viz-hc1-status" x="55" y="0" style="font-family:'IBM Plex Mono',monospace;font-size:11px;fill:rgba(0,255,255,0.9);">---</text>
                    </g>
                    <g transform="translate(0, 20)">
                        <text x="0" y="0" style="font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;fill:var(--viz-cyan);letter-spacing:2px;">HP:</text>
                        <text id="viz-hp-status" x="55" y="0" style="font-family:'IBM Plex Mono',monospace;font-size:11px;fill:rgba(0,255,255,0.9);">---</text>
                    </g>
                </g>
            </svg>
        </div>

        <!-- Alert for Fake Heating -->
        <div class="alert alert-danger animated" id="fake-heating-alert" style="display: none;">
            <span class="alert-icon mdi mdi-alert-circle mdi-spin"></span>
            <div>
                <strong>Fake Heating Detected!</strong>
                <p>Power is below 10W while water heater is active. The broken heater situation is detected.</p>
            </div>
            <button class="btn btn-sm" onclick="dismissAlert()">Dismiss</button>
        </div>

        <!-- Manual Override Alert -->
        <div class="alert alert-warning animated" id="override-alert" style="display: none;">
            <span class="alert-icon mdi mdi-hand-back-right"></span>
            <div>
                <strong>Manual Override Active</strong>
                <p>Automatic control is suspended. Override expires in: <span id="override-remaining">--</span></p>
            </div>
        </div>

        <!-- Quick Stats - Mobile First (no scroll needed) -->
        <div class="quick-stats">
            <!-- Power Widget -->
            <div class="quick-widget power-widget">
                <div class="quick-widget-icon">
                    <span class="mdi mdi-flash"></span>
                </div>
                <div class="quick-widget-content">
                    <span class="quick-widget-value" id="quick-power">--</span>
                    <span class="quick-widget-unit">W</span>
                </div>
                <div class="quick-widget-label">Power</div>
            </div>

            <!-- CWU Temp + State Widget -->
            <div class="quick-widget temp-widget" id="quick-temp-widget">
                <div class="quick-widget-header">
                    <span class="quick-state-badge" id="quick-state-badge">
                        <span class="mdi mdi-sleep" id="quick-state-icon"></span>
                        <span id="quick-state-name">Idle</span>
                    </span>
                </div>
                <div class="quick-widget-content">
                    <span class="quick-widget-value" id="quick-cwu-temp">--</span>
                    <span class="quick-widget-unit">°C</span>
                    <span class="quick-temp-change" id="quick-temp-change"></span>
                </div>
                <div class="quick-widget-label">CWU Temp</div>
            </div>

            <!-- Mini Power Chart Widget -->
            <div class="quick-widget chart-widget">
                <div class="quick-widget-label">Power 1h</div>
                <div class="quick-chart-container">
                    <canvas id="quickPowerChart"></canvas>
                </div>
            </div>
        </div>

        <!-- BSB-LAN Heat Pump Status -->
        <div class="bsb-lan-card" id="bsb-lan-card">
            <div class="bsb-lan-header">
                <div class="bsb-lan-title">
                    <span class="mdi mdi-heat-pump"></span>
                    <span>BSB-LAN Heat Pump</span>
                </div>
                <div class="bsb-lan-controls">
                    <span class="bsb-lan-status" id="bsb-lan-status">
                        <span class="mdi mdi-loading mdi-spin"></span>
                    </span>
                    <button class="btn btn-icon btn-sm" onclick="refreshBsbLan()" title="Refresh BSB-LAN">
                        <span class="mdi mdi-refresh" id="bsb-refresh-icon"></span>
                    </button>
                </div>
            </div>
            <div class="bsb-lan-content" id="bsb-lan-content">
                <div class="bsb-loading">
                    <span class="mdi mdi-loading mdi-spin"></span>
                    <span>Connecting to BSB-LAN...</span>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Compact State Bar + Mode Control - Full Width -->
            <div class="card mode-control-card glass-effect">
                <div class="mode-control-row">
                    <!-- Current State (compact) -->
                    <div class="state-compact" id="state-compact">
                        <span class="state-icon-sm mdi mdi-loading mdi-spin" id="state-icon-sm"></span>
                        <span class="state-name-sm" id="state-name-sm">Loading...</span>
                        <span class="state-duration-sm" id="state-duration-sm">--</span>
                    </div>

                    <!-- Mode Control -->
                    <div class="mode-selector">
                        <button class="mode-btn mode-auto active" id="mode-btn-auto" onclick="setModeAuto()">
                            <span class="mdi mdi-autorenew"></span>
                            <span class="mode-label">AUTO</span>
                        </button>
                        <button class="mode-btn mode-cwu" id="mode-btn-cwu" onclick="openModeModal('cwu')">
                            <span class="mdi mdi-water-boiler"></span>
                            <span class="mode-label">CWU</span>
                            <span class="mode-duration" id="mode-cwu-duration"></span>
                        </button>
                        <button class="mode-btn mode-floor" id="mode-btn-floor" onclick="openModeModal('floor')">
                            <span class="mdi mdi-heating-coil"></span>
                            <span class="mode-label">FLOOR</span>
                            <span class="mode-duration" id="mode-floor-duration"></span>
                        </button>
                    </div>

                    <!-- Heating Indicators -->
                    <div class="heating-indicators">
                        <div class="indicator" id="cwu-indicator" title="CWU Heating">
                            <span class="mdi mdi-water-boiler"></span>
                        </div>
                        <div class="indicator" id="floor-indicator" title="Floor Heating">
                            <span class="mdi mdi-heating-coil"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Visualization Card (Holographic) - DESKTOP VERSION -->
            <div class="card glass-effect system-viz-card system-viz-desktop" id="system-viz-card-desktop">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-heat-pump"></span>
                        System Overview
                    </span>
                    <span class="badge" id="viz-state-badge">--</span>
                </div>
                <div class="system-viz-content">
                    <svg viewBox="0 -15 480 330" class="system-viz-svg-desktop">
                        <defs>
                            <linearGradient id="vizHelixGradDesktop" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#FF5533"/>
                                <stop offset="30%" stop-color="#FF7744"/>
                                <stop offset="50%" stop-color="#DDAA44"/>
                                <stop offset="70%" stop-color="#44AADD"/>
                                <stop offset="100%" stop-color="#0088FF"/>
                            </linearGradient>
                            <linearGradient id="vizWaterGradDesktop" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#FF5533" stop-opacity="0.3"/>
                                <stop offset="40%" stop-color="#CC8844" stop-opacity="0.2"/>
                                <stop offset="70%" stop-color="#44AADD" stop-opacity="0.2"/>
                                <stop offset="100%" stop-color="#0066FF" stop-opacity="0.3"/>
                            </linearGradient>
                            <clipPath id="vizTankClipDesktop"><path d="M14,28 L14,215 A48,12 0 0,0 106,215 L106,28 A48,12 0 0,1 14,28"/></clipPath>
                        </defs>
                        <!-- HEAT PUMP -->
                        <g transform="translate(15, 45)">
                            <rect class="viz-w viz-f viz-glow" x="0" y="0" width="130" height="85" rx="3"/>
                            <rect class="viz-w-dim viz-f" x="3" y="3" width="75" height="79" rx="2"/>
                            <circle class="viz-w viz-glow-s" cx="40" cy="42" r="34"/>
                            <circle class="viz-w-dim viz-pulse" cx="40" cy="42" r="38" stroke-dasharray="5 3"/>
                            <circle class="viz-w-dim" cx="40" cy="42" r="30" stroke-dasharray="3 3" style="opacity:0.25"/>
                            <g class="viz-fan viz-glow-s viz-fan-desktop" style="transform-origin: 40px 42px;">
                                <path class="viz-blade-fill" d="M40,42 L37,32 Q28,14 38,4 Q48,3 52,12 Q54,26 44,38 Z"/>
                                <path class="viz-blade-fill" d="M40,42 L50,39 Q68,30 78,40 Q78,50 68,54 Q52,55 44,45 Z"/>
                                <path class="viz-blade-fill" d="M40,42 L43,52 Q52,70 42,80 Q32,81 28,72 Q26,56 36,46 Z"/>
                                <path class="viz-blade-fill" d="M40,42 L30,45 Q12,54 2,44 Q2,34 12,30 Q28,29 36,39 Z"/>
                                <circle cx="40" cy="42" r="10" fill="rgba(0,12,24,0.95)" class="viz-w viz-glow"/>
                                <circle cx="40" cy="42" r="6" fill="rgba(0,30,50,0.9)" class="viz-w"/>
                                <circle cx="40" cy="42" r="2.5" fill="#00FFFF" class="viz-glow-s"/>
                            </g>
                            <g transform="translate(105, 42)" class="viz-power-group-desktop">
                                <rect class="viz-power-badge" x="-26" y="-18" width="52" height="36" rx="4"/>
                                <text class="viz-power-value viz-power-value-desktop" x="0" y="2" text-anchor="middle">--</text>
                                <text class="viz-power-unit viz-power-unit-desktop" x="0" y="14" text-anchor="middle">W</text>
                            </g>
                            <g class="viz-defrost-indicator viz-defrost-indicator-desktop" transform="translate(40, 42)">
                                <circle cx="0" cy="0" r="38" fill="rgba(136,221,255,0.08)" class="viz-defrost-icon"/>
                                <g class="viz-defrost-icon" transform="scale(1.8)">
                                    <line x1="0" y1="-12" x2="0" y2="12" stroke="#88DDFF" stroke-width="2.5" stroke-linecap="round"/>
                                    <line x1="-10" y1="-6" x2="10" y2="6" stroke="#88DDFF" stroke-width="2.5" stroke-linecap="round"/>
                                    <line x1="-10" y1="6" x2="10" y2="-6" stroke="#88DDFF" stroke-width="2.5" stroke-linecap="round"/>
                                    <line x1="0" y1="-12" x2="-4" y2="-8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="0" y1="-12" x2="4" y2="-8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="0" y1="12" x2="-4" y2="8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="0" y1="12" x2="4" y2="8" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="-10" y1="-6" x2="-7" y2="-9" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="10" y1="6" x2="7" y2="9" stroke="#88DDFF" stroke-width="2" stroke-linecap="round"/>
                                </g>
                            </g>
                            <g class="viz-defrost-indicator viz-defrost-label-desktop" transform="translate(40, 98)">
                                <rect x="-32" y="-8" width="64" height="16" rx="3" fill="rgba(136,221,255,0.15)" stroke="#88DDFF" stroke-width="1"/>
                                <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:10px;font-weight:600;fill:#88DDFF;letter-spacing:2px;">DEFROST</text>
                            </g>
                            <rect class="viz-w viz-glow" x="10" y="85" width="25" height="6" rx="1"/>
                            <rect class="viz-w viz-glow" x="95" y="85" width="25" height="6" rx="1"/>
                            <circle class="viz-conn-hot" cx="130" cy="20" r="6"/>
                            <circle class="viz-conn-cold" cx="130" cy="70" r="6"/>
                        </g>
                        <!-- CWU TANK -->
                        <g class="viz-tank-view viz-tank-view-desktop" transform="translate(310, -5)">
                            <ellipse class="viz-w-dim viz-pulse" cx="60" cy="15" rx="48" ry="12"/>
                            <line class="viz-w-bright" x1="12" y1="15" x2="12" y2="215"/>
                            <line class="viz-w-bright" x1="108" y1="15" x2="108" y2="215"/>
                            <ellipse class="viz-w-bright" cx="60" cy="215" rx="48" ry="12"/>
                            <rect x="12" y="28" width="96" height="200" fill="url(#vizWaterGradDesktop)" clip-path="url(#vizTankClipDesktop)"/>
                            <path class="viz-helix viz-helix-back" style="stroke:url(#vizHelixGradDesktop)" d="M22,35 C22,43 98,43 98,51 C98,59 22,59 22,67 C22,75 98,75 98,83 C98,91 22,91 22,99 C22,107 98,107 98,115 C98,123 22,123 22,131 C22,139 98,139 98,147 C98,155 22,155 22,163 C22,171 98,171 98,179 C98,187 22,187 22,195"/>
                            <path class="viz-helix viz-helix-front viz-helix-flow" style="stroke:url(#vizHelixGradDesktop)" d="M22,35 C22,43 98,43 98,51 C98,59 22,59 22,67 C22,75 98,75 98,83 C98,91 22,91 22,99 C22,107 98,107 98,115 C98,123 22,123 22,131 C22,139 98,139 98,147 C98,155 22,155 22,163 C22,171 98,171 98,179 C98,187 22,187 22,195"/>
                            <g transform="translate(60, 5)">
                                <rect class="viz-target-badge" x="-32" y="-12" width="64" height="28" rx="4"/>
                                <text class="viz-target-label" x="0" y="-3" text-anchor="middle">TARGET</text>
                                <text class="viz-target-value viz-target-temp-desktop" x="0" y="11" text-anchor="middle">--°C</text>
                            </g>
                            <g transform="translate(60, 155)">
                                <rect class="viz-temp-badge" x="-36" y="-16" width="72" height="32" rx="5"/>
                                <text class="viz-temp-badge-value viz-cwu-temp-desktop" x="0" y="6" text-anchor="middle">--°</text>
                            </g>
                            <text class="viz-label" x="60" y="245" text-anchor="middle" style="font-size:10px; letter-spacing:3px;">CWU</text>
                            <!-- Electric heater indicator -->
                            <g class="viz-heater-indicator viz-cwu-heater-indicator-desktop" transform="translate(60, 228)">
                                <rect x="-28" y="-8" width="56" height="16" rx="3" fill="rgba(255,136,0,0.15)" stroke="#FF8800" stroke-width="1"/>
                                <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#FF8800;letter-spacing:1px;">⚡ HEATER</text>
                            </g>
                            <!-- Compressor indicator -->
                            <g class="viz-compressor-indicator viz-cwu-compressor-indicator-desktop" transform="translate(60, 210)">
                                <rect x="-32" y="-8" width="64" height="16" rx="3" fill="rgba(0,200,255,0.15)" stroke="#00C8FF" stroke-width="1"/>
                                <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#00C8FF;letter-spacing:1px;">❄ COMPRESSOR</text>
                            </g>
                        </g>
                        <!-- Pipes to tank -->
                        <g class="viz-tank-view viz-tank-view-desktop">
                            <path class="viz-pipe-hot viz-pipe-flow" d="M145,65 L200,65 L200,30 L332,30"/>
                            <rect x="195" y="-2" width="52" height="24" rx="4" fill="rgba(255,85,51,0.2)" stroke="var(--viz-hot)" stroke-width="1.5"/>
                            <text class="viz-flow-badge viz-flow-temp-cwu-desktop" x="221" y="16" text-anchor="middle" fill="var(--viz-hot)">--°</text>
                            <path class="viz-pipe-cold viz-pipe-flow" d="M332,190 L200,190 L200,115 L145,115"/>
                            <rect x="195" y="196" width="52" height="24" rx="4" fill="rgba(0,136,255,0.2)" stroke="var(--viz-cold)" stroke-width="1.5"/>
                            <text class="viz-return-badge viz-return-temp-cwu-desktop" x="221" y="214" text-anchor="middle" fill="var(--viz-cold)">--°</text>
                        </g>
                        <!-- Delta T (CWU) -->
                        <g class="viz-tank-view viz-tank-view-desktop viz-delta-badge" transform="translate(185, 90)">
                            <rect x="-28" y="-14" width="56" height="30" rx="5" fill="rgba(0,255,255,0.15)" stroke="var(--viz-cyan)" stroke-width="1.5"/>
                            <text x="0" y="-4" text-anchor="middle" style="font-family:'IBM Plex Mono',monospace;font-size:9px; fill:rgba(0,255,255,0.9);">ΔT</text>
                            <text class="viz-delta-cwu-desktop" x="0" y="11" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:15px;font-weight:700; fill:var(--viz-cyan);">--°</text>
                        </g>
                        <!-- FLOOR HEATING -->
                        <g class="viz-floor-view viz-floor-view-desktop" transform="translate(260, 15)">
                            <rect class="viz-floor-surface" x="10" y="10" width="180" height="145" rx="4"/>
                            <path class="viz-floor-pipe viz-fp-hot viz-pipe-flow" d="M20,24 L180,24"/>
                            <path class="viz-floor-pipe viz-fp-hot viz-pipe-flow" d="M180,24 L180,40"/>
                            <path class="viz-floor-pipe viz-fp-w1 viz-pipe-flow" d="M180,40 L30,40"/>
                            <path class="viz-floor-pipe viz-fp-w1 viz-pipe-flow" d="M30,40 L30,56"/>
                            <path class="viz-floor-pipe viz-fp-w2 viz-pipe-flow" d="M30,56 L180,56"/>
                            <path class="viz-floor-pipe viz-fp-w2 viz-pipe-flow" d="M180,56 L180,72"/>
                            <path class="viz-floor-pipe viz-fp-w3 viz-pipe-flow" d="M180,72 L30,72"/>
                            <path class="viz-floor-pipe viz-fp-w3 viz-pipe-flow" d="M30,72 L30,88"/>
                            <path class="viz-floor-pipe viz-fp-c1 viz-pipe-flow" d="M30,88 L180,88"/>
                            <path class="viz-floor-pipe viz-fp-c1 viz-pipe-flow" d="M180,88 L180,104"/>
                            <path class="viz-floor-pipe viz-fp-c2 viz-pipe-flow" d="M180,104 L30,104"/>
                            <path class="viz-floor-pipe viz-fp-c2 viz-pipe-flow" d="M30,104 L30,120"/>
                            <path class="viz-floor-pipe viz-fp-c3 viz-pipe-flow" d="M30,120 L180,120"/>
                            <path class="viz-floor-pipe viz-fp-c3 viz-pipe-flow" d="M180,120 L180,136"/>
                            <path class="viz-floor-pipe viz-fp-cold viz-pipe-flow" d="M180,136 L30,136"/>
                            <path class="viz-floor-pipe viz-fp-cold viz-pipe-flow" d="M30,136 L30,145 L20,145"/>
                            <circle class="viz-conn-hot" cx="20" cy="24" r="5"/>
                            <circle class="viz-conn-cold" cx="20" cy="145" r="5"/>
                            <text class="viz-label" x="100" y="168" text-anchor="middle" style="font-size:9px; letter-spacing:2px;">PODŁOGOWE</text>
                            <!-- Electric heater indicator -->
                            <g class="viz-heater-indicator viz-floor-heater-indicator-desktop" transform="translate(100, 182)">
                                <rect x="-28" y="-8" width="56" height="16" rx="3" fill="rgba(255,136,0,0.15)" stroke="#FF8800" stroke-width="1"/>
                                <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#FF8800;letter-spacing:1px;">⚡ HEATER</text>
                            </g>
                            <!-- Compressor indicator -->
                            <g class="viz-compressor-indicator viz-floor-compressor-indicator-desktop" transform="translate(100, 198)">
                                <rect x="-32" y="-8" width="64" height="16" rx="3" fill="rgba(0,200,255,0.15)" stroke="#00C8FF" stroke-width="1"/>
                                <text x="0" y="4" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:9px;font-weight:600;fill:#00C8FF;letter-spacing:1px;">❄ COMPRESSOR</text>
                            </g>
                        </g>
                        <!-- Pipes to floor -->
                        <g class="viz-floor-view viz-floor-view-desktop">
                            <path class="viz-pipe-hot viz-pipe-flow" d="M145,65 L200,65 L200,39 L280,39"/>
                            <rect x="200" y="15" width="42" height="18" rx="3" fill="rgba(255,85,51,0.15)" stroke="var(--viz-hot)" stroke-width="1"/>
                            <text class="viz-flow-badge viz-flow-temp-floor-desktop" x="221" y="29" text-anchor="middle" fill="var(--viz-hot)">--°</text>
                            <path class="viz-pipe-cold viz-pipe-flow" d="M280,160 L220,160 L220,115 L145,115"/>
                            <rect x="215" y="168" width="42" height="18" rx="3" fill="rgba(0,136,255,0.15)" stroke="var(--viz-cold)" stroke-width="1"/>
                            <text class="viz-return-badge viz-return-temp-floor-desktop" x="236" y="182" text-anchor="middle" fill="var(--viz-cold)">--°</text>
                        </g>
                        <!-- Delta T (Floor) -->
                        <g class="viz-floor-view viz-floor-view-desktop viz-delta-badge" transform="translate(185, 90)">
                            <rect x="-28" y="-14" width="56" height="30" rx="5" fill="rgba(0,255,255,0.15)" stroke="var(--viz-cyan)" stroke-width="1.5"/>
                            <text x="0" y="-4" text-anchor="middle" style="font-family:'IBM Plex Mono',monospace;font-size:9px; fill:rgba(0,255,255,0.9);">ΔT</text>
                            <text class="viz-delta-floor-desktop" x="0" y="11" text-anchor="middle" style="font-family:'Oxanium',sans-serif;font-size:15px;font-weight:700; fill:var(--viz-cyan);">--°</text>
                        </g>
                        <!-- Status section -->
                        <g transform="translate(15, 250)">
                            <rect x="-8" y="-16" width="220" height="52" rx="6" fill="rgba(0,20,40,0.8)" stroke="rgba(0,255,255,0.2)" stroke-width="1"/>
                            <g class="viz-tank-view viz-tank-view-desktop">
                                <text x="0" y="0" style="font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;fill:var(--viz-hot);letter-spacing:2px;">DHW:</text>
                                <text class="viz-dhw-status-desktop" x="55" y="0" style="font-family:'IBM Plex Mono',monospace;font-size:11px;fill:rgba(0,255,255,0.9);">---</text>
                            </g>
                            <g class="viz-floor-view viz-floor-view-desktop">
                                <text x="0" y="0" style="font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;fill:var(--viz-warm1);letter-spacing:2px;">HC1:</text>
                                <text class="viz-hc1-status-desktop" x="55" y="0" style="font-family:'IBM Plex Mono',monospace;font-size:11px;fill:rgba(0,255,255,0.9);">---</text>
                            </g>
                            <g transform="translate(0, 20)">
                                <text x="0" y="0" style="font-family:'Oxanium',sans-serif;font-size:12px;font-weight:700;fill:var(--viz-cyan);letter-spacing:2px;">HP:</text>
                                <text class="viz-hp-status-desktop" x="55" y="0" style="font-family:'IBM Plex Mono',monospace;font-size:11px;fill:rgba(0,255,255,0.9);">---</text>
                            </g>
                        </g>
                    </svg>
                </div>
            </div>

            <!-- Operating Mode & Tariff Card -->
            <div class="card glass-effect mode-tariff-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-cog"></span>
                        Operating Mode
                    </span>
                    <span class="badge" id="tariff-status">--</span>
                </div>
                <div class="mode-tariff-content">
                    <div class="mode-selector-section">
                        <label for="operating-mode-select">Mode:</label>
                        <select id="operating-mode-select" class="mode-select" onchange="changeOperatingMode(this.value)">
                            <option value="broken_heater">Broken Heater</option>
                            <option value="winter">Winter</option>
                            <option value="summer">Summer (N/A)</option>
                            <option value="heat_pump">Heat Pump</option>
                        </select>
                    </div>
                    <div class="tariff-info">
                        <div class="tariff-row">
                            <span class="mdi mdi-currency-usd"></span>
                            <span>Current rate: <strong id="current-tariff-rate">--</strong> zł/kWh</span>
                        </div>
                        <div class="tariff-rates-config">
                            <div class="tariff-rate cheap">
                                <span class="mdi mdi-leaf"></span>
                                <span>Cheap: <strong id="tariff-cheap-rate">--</strong> zł</span>
                            </div>
                            <div class="tariff-rate expensive">
                                <span class="mdi mdi-fire"></span>
                                <span>Peak: <strong id="tariff-expensive-rate">--</strong> zł</span>
                            </div>
                        </div>
                        <div class="tariff-row" id="heating-window-row" style="display: none;">
                            <span class="mdi mdi-clock-check"></span>
                            <span id="heating-window-status">CWU heating window active</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Energy Consumption Card -->
            <div class="card glass-effect energy-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-lightning-bolt"></span>
                        Energy Consumption
                    </span>
                </div>
                <div class="energy-content">
                    <div class="energy-period">
                        <h4>Today</h4>
                        <div class="energy-row">
                            <span class="energy-label"><span class="mdi mdi-water-boiler"></span> CWU:</span>
                            <span class="energy-value" id="energy-today-cwu">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-leaf"></span> Cheap:</span>
                            <span class="energy-value energy-cheap" id="energy-today-cwu-cheap">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-fire"></span> Peak:</span>
                            <span class="energy-value energy-expensive" id="energy-today-cwu-expensive">0.00 kWh</span>
                        </div>
                        <div class="energy-row">
                            <span class="energy-label"><span class="mdi mdi-heating-coil"></span> Floor:</span>
                            <span class="energy-value" id="energy-today-floor">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-leaf"></span> Cheap:</span>
                            <span class="energy-value energy-cheap" id="energy-today-floor-cheap">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-fire"></span> Peak:</span>
                            <span class="energy-value energy-expensive" id="energy-today-floor-expensive">0.00 kWh</span>
                        </div>
                        <div class="energy-row total">
                            <span class="energy-label">Total:</span>
                            <span class="energy-value" id="energy-today-total">0.00 kWh</span>
                        </div>
                        <div class="energy-row cost">
                            <span class="energy-label">Est. cost:</span>
                            <span class="energy-value" id="cost-today">~0.00 zł</span>
                        </div>
                        <div class="energy-row cost sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-water-boiler"></span> CWU:</span>
                            <span class="energy-value" id="cost-today-cwu">~0.00 zł</span>
                        </div>
                        <div class="energy-row cost sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-heating-coil"></span> Floor:</span>
                            <span class="energy-value" id="cost-today-floor">~0.00 zł</span>
                        </div>
                    </div>
                    <div class="energy-divider"></div>
                    <div class="energy-period">
                        <h4>Yesterday</h4>
                        <div class="energy-row">
                            <span class="energy-label"><span class="mdi mdi-water-boiler"></span> CWU:</span>
                            <span class="energy-value" id="energy-yesterday-cwu">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-leaf"></span> Cheap:</span>
                            <span class="energy-value energy-cheap" id="energy-yesterday-cwu-cheap">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-fire"></span> Peak:</span>
                            <span class="energy-value energy-expensive" id="energy-yesterday-cwu-expensive">0.00 kWh</span>
                        </div>
                        <div class="energy-row">
                            <span class="energy-label"><span class="mdi mdi-heating-coil"></span> Floor:</span>
                            <span class="energy-value" id="energy-yesterday-floor">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-leaf"></span> Cheap:</span>
                            <span class="energy-value energy-cheap" id="energy-yesterday-floor-cheap">0.00 kWh</span>
                        </div>
                        <div class="energy-row sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-fire"></span> Peak:</span>
                            <span class="energy-value energy-expensive" id="energy-yesterday-floor-expensive">0.00 kWh</span>
                        </div>
                        <div class="energy-row total">
                            <span class="energy-label">Total:</span>
                            <span class="energy-value" id="energy-yesterday-total">0.00 kWh</span>
                        </div>
                        <div class="energy-row cost">
                            <span class="energy-label">Est. cost:</span>
                            <span class="energy-value" id="cost-yesterday">~0.00 zł</span>
                        </div>
                        <div class="energy-row cost sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-water-boiler"></span> CWU:</span>
                            <span class="energy-value" id="cost-yesterday-cwu">~0.00 zł</span>
                        </div>
                        <div class="energy-row cost sub">
                            <span class="energy-label energy-sub"><span class="mdi mdi-heating-coil"></span> Floor:</span>
                            <span class="energy-value" id="cost-yesterday-floor">~0.00 zł</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CWU Session Tracking Card (with cycle info merged) -->
            <div class="card glass-effect cwu-session-card" id="cwu-session-card" style="display: none;">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-water-thermometer"></span>
                        CWU Heating Session
                    </span>
                    <span class="badge badge-info" id="session-status">Active</span>
                </div>
                <div class="session-content">
                    <div class="session-temps">
                        <div class="session-temp-item">
                            <span class="session-temp-label">Start</span>
                            <span class="session-temp-value" id="session-start-temp">--°C</span>
                        </div>
                        <div class="session-temp-arrow">
                            <span class="mdi mdi-arrow-right"></span>
                            <span class="session-temp-change" id="session-temp-change">+0.0°C</span>
                        </div>
                        <div class="session-temp-item">
                            <span class="session-temp-label">Current</span>
                            <span class="session-temp-value" id="session-current-temp">--°C</span>
                        </div>
                        <div class="session-temp-arrow">
                            <span class="mdi mdi-arrow-right-bold"></span>
                        </div>
                        <div class="session-temp-item target">
                            <span class="session-temp-label">Target</span>
                            <span class="session-temp-value" id="session-target-temp">45°C</span>
                        </div>
                    </div>
                    <div class="session-progress-container">
                        <div class="session-progress-bar">
                            <div class="session-progress-fill" id="session-progress-fill"></div>
                            <div class="session-progress-marker" id="session-progress-marker"></div>
                        </div>
                        <div class="session-progress-labels">
                            <span id="session-progress-start">35°C</span>
                            <span id="session-progress-percent">0%</span>
                            <span id="session-progress-end">45°C</span>
                        </div>
                    </div>
                    <div class="session-stats">
                        <div class="session-stat">
                            <span class="mdi mdi-clock-start"></span>
                            <span>Started: <strong id="session-start-time">--</strong></span>
                        </div>
                        <div class="session-stat">
                            <span class="mdi mdi-timer-sand"></span>
                            <span>Duration: <strong id="session-duration">--</strong></span>
                        </div>
                        <div class="session-stat">
                            <span class="mdi mdi-speedometer"></span>
                            <span>Rate: <strong id="session-rate">--</strong>°C/h</span>
                        </div>
                        <div class="session-stat">
                            <span class="mdi mdi-clock-end"></span>
                            <span>ETA: <strong id="session-eta">--</strong></span>
                        </div>
                        <div class="session-stat energy">
                            <span class="mdi mdi-lightning-bolt"></span>
                            <span>Energy: <strong id="session-energy">--</strong> kWh</span>
                        </div>
                    </div>
                    <div class="session-forecast">
                        <div class="forecast-item">
                            <span class="forecast-label">Estimated completion</span>
                            <span class="forecast-value" id="forecast-completion">--</span>
                        </div>
                        <div class="forecast-item">
                            <span class="forecast-label">Temp at session end (170min)</span>
                            <span class="forecast-value" id="forecast-temp-at-end">--°C</span>
                        </div>
                        <div class="forecast-item">
                            <span class="forecast-label">Sessions needed</span>
                            <span class="forecast-value" id="forecast-sessions">--</span>
                        </div>
                    </div>
                    <div class="session-comparison">
                        <span class="mdi mdi-history"></span>
                        <span>vs 1h ago: <strong id="session-vs-1h">--</strong></span>
                    </div>

                    <!-- Heat Pump Data (from BSB-LAN) -->
                    <div class="session-pump-data" id="session-pump-data">
                        <div class="pump-data-header">
                            <span class="mdi mdi-heat-pump"></span>
                            <span>Heat Pump</span>
                        </div>
                        <div class="pump-data-grid">
                            <div class="pump-data-item">
                                <span class="pump-label">CWU (pump)</span>
                                <span class="pump-value" id="session-pump-cwu">--°C</span>
                            </div>
                            <div class="pump-data-item">
                                <span class="pump-label">Flow</span>
                                <span class="pump-value" id="session-pump-flow">--°C</span>
                            </div>
                            <div class="pump-data-item">
                                <span class="pump-label">Return</span>
                                <span class="pump-value" id="session-pump-return">--°C</span>
                            </div>
                            <div class="pump-data-item delta">
                                <span class="pump-label">ΔT</span>
                                <span class="pump-value" id="session-pump-delta">--°C</span>
                            </div>
                        </div>
                    </div>

                    <!-- Cycle Timer (merged from separate card) -->
                    <div class="session-cycle">
                        <div class="cycle-mini">
                            <div class="cycle-progress-ring">
                                <svg width="60" height="60" viewBox="0 0 60 60">
                                    <circle class="bg" cx="30" cy="30" r="25" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="4"/>
                                    <circle class="progress" id="session-cycle-progress" cx="30" cy="30" r="25"
                                        fill="none" stroke="#00d9ff" stroke-width="4"
                                        stroke-dasharray="157" stroke-dashoffset="157"
                                        transform="rotate(-90 30 30)"/>
                                </svg>
                                <span class="cycle-mini-value" id="session-cycle-time">0</span>
                            </div>
                            <div class="cycle-mini-info">
                                <span class="cycle-mini-label">Cycle Time</span>
                                <span class="cycle-mini-remaining"><span id="session-cycle-remaining">170</span> min left (max 170)</span>
                            </div>
                        </div>
                        <div class="cycle-warning-mini" id="session-cycle-warning" style="display: none;">
                            <span class="mdi mdi-alert"></span>
                            <span>Pause coming soon!</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temperatures Card -->
            <div class="card glass-effect">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-thermometer"></span>
                        Temperatures
                    </span>
                    <span class="badge" id="temp-status">OK</span>
                </div>
                <div class="temp-grid">
                    <div class="temp-item" id="temp-cwu" data-target="45">
                        <div class="temp-icon-wrapper">
                            <span class="icon mdi mdi-water-thermometer"></span>
                        </div>
                        <div class="temp-data">
                            <div class="label">CWU Water</div>
                            <div class="value">--<span class="unit">°C</span></div>
                            <div class="temp-bar"><div class="temp-bar-fill"></div></div>
                        </div>
                    </div>
                    <div class="temp-item" id="temp-salon" data-target="22">
                        <div class="temp-icon-wrapper">
                            <span class="icon mdi mdi-sofa"></span>
                        </div>
                        <div class="temp-data">
                            <div class="label">Living Room</div>
                            <div class="value">--<span class="unit">°C</span></div>
                            <div class="temp-bar"><div class="temp-bar-fill"></div></div>
                        </div>
                    </div>
                    <div class="temp-item" id="temp-bedroom" data-target="20">
                        <div class="temp-icon-wrapper">
                            <span class="icon mdi mdi-bed"></span>
                        </div>
                        <div class="temp-data">
                            <div class="label">Bedroom</div>
                            <div class="value">--<span class="unit">°C</span></div>
                            <div class="temp-bar"><div class="temp-bar-fill"></div></div>
                        </div>
                    </div>
                    <div class="temp-item" id="temp-kids" data-target="20">
                        <div class="temp-icon-wrapper">
                            <span class="icon mdi mdi-teddy-bear"></span>
                        </div>
                        <div class="temp-data">
                            <div class="label">Kids Room</div>
                            <div class="value">--<span class="unit">°C</span></div>
                            <div class="temp-bar"><div class="temp-bar-fill"></div></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Urgency Card -->
            <div class="card glass-effect">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-gauge"></span>
                        Urgency Levels
                    </span>
                </div>
                <div class="urgency-container">
                    <div class="urgency-item">
                        <div class="urgency-gauge">
                            <svg width="140" height="140" viewBox="0 0 140 140">
                                <circle class="bg" cx="70" cy="70" r="60"/>
                                <circle class="value" id="cwu-urgency-circle" cx="70" cy="70" r="60"
                                    stroke-dasharray="377" stroke-dashoffset="377"/>
                            </svg>
                            <div class="urgency-center">
                                <div class="urgency-value" id="cwu-urgency-value">0</div>
                                <div class="urgency-max">/4</div>
                            </div>
                        </div>
                        <div class="urgency-label">
                            <span class="mdi mdi-water-thermometer"></span>
                            CWU Urgency
                        </div>
                        <div class="urgency-level" id="cwu-urgency-level">None</div>
                    </div>
                    <div class="urgency-item">
                        <div class="urgency-gauge">
                            <svg width="140" height="140" viewBox="0 0 140 140">
                                <circle class="bg" cx="70" cy="70" r="60"/>
                                <circle class="value" id="floor-urgency-circle" cx="70" cy="70" r="60"
                                    stroke-dasharray="377" stroke-dashoffset="377"/>
                            </svg>
                            <div class="urgency-center">
                                <div class="urgency-value" id="floor-urgency-value">0</div>
                                <div class="urgency-max">/4</div>
                            </div>
                        </div>
                        <div class="urgency-label">
                            <span class="mdi mdi-home-thermometer"></span>
                            Floor Urgency
                        </div>
                        <div class="urgency-level" id="floor-urgency-level">None</div>
                    </div>
                </div>
            </div>

            <!-- Power Card - IMPROVED -->
            <div class="card glass-effect">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-flash"></span>
                        Power Consumption
                    </span>
                    <span class="badge" id="power-status">--</span>
                </div>
                <div class="power-display">
                    <div class="power-main">
                        <div class="power-value-wrapper">
                            <span class="power-value" id="power-value">--</span>
                            <span class="power-unit">W</span>
                        </div>
                        <div class="power-indicator" id="power-indicator">
                            <span class="mdi mdi-circle"></span>
                            <span id="power-status-text">Unknown</span>
                        </div>
                    </div>
                    <div class="power-bar-container">
                        <div class="power-bar-labels">
                            <span>0</span>
                            <span>1kW</span>
                            <span>2kW</span>
                            <span>3kW</span>
                            <span>4.5kW</span>
                        </div>
                        <div class="power-bar">
                            <div class="power-bar-fill" id="power-bar"></div>
                            <div class="power-threshold" style="left: 1.7%;" title="Pump working (80W)"></div>
                            <div class="power-threshold major" style="left: 33%;" title="CWU Heating (~1.5kW)"></div>
                            <div class="power-threshold major" style="left: 71%;" title="CWU Max (~3.2kW)"></div>
                        </div>
                    </div>
                    <div class="power-stats">
                        <div class="power-stat">
                            <span class="label">10min Avg</span>
                            <span class="value" id="power-avg">--</span>W
                        </div>
                        <div class="power-stat">
                            <span class="label">Peak (10m)</span>
                            <span class="value" id="power-peak">--</span>W
                        </div>
                        <div class="power-stat">
                            <span class="label">Cycle</span>
                            <span class="value" id="power-cycle-status">--</span>
                        </div>
                    </div>
                    <div class="power-cycle-info" id="power-cycle-info">
                        <span class="mdi mdi-information-outline"></span>
                        <span id="power-cycle-text">Pump works in cycles: peaks ~1.5kW with 6-7min intervals, 80W = pump circulating</span>
                    </div>
                </div>
            </div>

            <!-- Temperature Chart - with fullscreen -->
            <div class="card glass-effect chart-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-chart-line"></span>
                        Temperature History
                    </span>
                    <div class="chart-controls">
                        <button class="btn btn-sm" onclick="updateChartRange('tempChart', '1h')">1H</button>
                        <button class="btn btn-sm active" onclick="updateChartRange('tempChart', '6h')" id="temp-6h-btn">6H</button>
                        <button class="btn btn-sm" onclick="updateChartRange('tempChart', '24h')">24H</button>
                        <button class="btn btn-icon btn-sm" onclick="openFullscreenChart('temp')" title="Fullscreen">
                            <span class="mdi mdi-fullscreen"></span>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>

            <!-- Power Chart - with fullscreen -->
            <div class="card glass-effect chart-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-chart-areaspline"></span>
                        Power History
                    </span>
                    <div class="chart-controls">
                        <button class="btn btn-sm" onclick="updateChartRange('powerChart', '1h')">1H</button>
                        <button class="btn btn-sm active" onclick="updateChartRange('powerChart', '6h')" id="power-6h-btn">6H</button>
                        <button class="btn btn-sm" onclick="updateChartRange('powerChart', '24h')">24H</button>
                        <button class="btn btn-icon btn-sm" onclick="openFullscreenChart('power')" title="Fullscreen">
                            <span class="mdi mdi-fullscreen"></span>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="powerChart"></canvas>
                </div>
            </div>

            <!-- Technical Temps Chart (BSB-LAN) -->
            <div class="card glass-effect chart-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-thermometer-lines"></span>
                        Heat Pump Temps (BSB-LAN)
                    </span>
                    <div class="chart-controls">
                        <button class="btn btn-sm" onclick="updateChartRange('techChart', '1h')">1H</button>
                        <button class="btn btn-sm active" onclick="updateChartRange('techChart', '6h')" id="tech-6h-btn">6H</button>
                        <button class="btn btn-sm" onclick="updateChartRange('techChart', '24h')">24H</button>
                        <button class="btn btn-icon btn-sm" onclick="openFullscreenChart('tech')" title="Fullscreen">
                            <span class="mdi mdi-fullscreen"></span>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="techChart"></canvas>
                </div>
                <div class="chart-legend-custom">
                    <span class="legend-item"><span class="legend-color" style="background:#00d9ff"></span>CWU</span>
                    <span class="legend-item"><span class="legend-color" style="background:#fc8181"></span>Flow</span>
                    <span class="legend-item"><span class="legend-color" style="background:#68d391"></span>Return</span>
                    <span class="legend-item"><span class="legend-color" style="background:#f6e05e"></span>ΔT</span>
                </div>
            </div>

            <!-- Outside Temperature Chart -->
            <div class="card glass-effect chart-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-weather-partly-cloudy"></span>
                        Outside Temperature
                    </span>
                    <div class="chart-controls">
                        <button class="btn btn-sm" onclick="updateChartRange('outsideChart', '6h')">6H</button>
                        <button class="btn btn-sm active" onclick="updateChartRange('outsideChart', '24h')" id="outside-24h-btn">24H</button>
                        <button class="btn btn-sm" onclick="updateChartRange('outsideChart', '48h')">48H</button>
                        <button class="btn btn-sm" onclick="updateChartRange('outsideChart', '7d')">7D</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="outsideChart"></canvas>
                </div>
            </div>

            <!-- Test Actions -->
            <div class="card glass-effect">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-test-tube"></span>
                        Test Actions
                    </span>
                    <span class="badge badge-warning">Testing</span>
                </div>
                <p class="card-description">Test individual actions to verify integration works correctly.</p>
                <div class="test-grid">
                    <button class="test-btn test-cwu-on" onclick="testAction('cwu_on')">
                        <span class="mdi mdi-water-boiler"></span>
                        <span>CWU ON</span>
                    </button>
                    <button class="test-btn test-cwu-off" onclick="testAction('cwu_off')">
                        <span class="mdi mdi-water-boiler-off"></span>
                        <span>CWU OFF</span>
                    </button>
                    <button class="test-btn test-floor-on" onclick="testAction('floor_on')">
                        <span class="mdi mdi-heating-coil"></span>
                        <span>Floor ON</span>
                    </button>
                    <button class="test-btn test-floor-off" onclick="testAction('floor_off')">
                        <span class="mdi mdi-radiator-off"></span>
                        <span>Floor OFF</span>
                    </button>
                </div>
            </div>

            <!-- Heat Pump Status -->
            <div class="card glass-effect">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-heat-pump"></span>
                        System Status
                    </span>
                </div>
                <div class="system-status">
                    <div class="status-row">
                        <div class="status-item">
                            <span class="status-icon mdi mdi-water-boiler"></span>
                            <div class="status-info">
                                <span class="status-label">CWU Mode (BSB)</span>
                                <span class="status-value" id="wh-state">--</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <span class="status-icon mdi mdi-heating-coil"></span>
                            <div class="status-info">
                                <span class="status-label">Floor Mode (BSB)</span>
                                <span class="status-value" id="climate-state">--</span>
                            </div>
                        </div>
                    </div>
                    <div class="status-row">
                        <div class="status-item">
                            <span class="status-icon mdi mdi-hand-back-right"></span>
                            <div class="status-info">
                                <span class="status-label">Manual Override</span>
                                <span class="status-value" id="override-state">--</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <span class="status-icon mdi mdi-connection"></span>
                            <div class="status-info">
                                <span class="status-label">Connection</span>
                                <span class="status-value" id="connection-state">Connected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action History - with relative time and modal -->
            <div class="card glass-effect history-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-history"></span>
                        Action History
                    </span>
                    <button class="btn btn-icon btn-sm" onclick="openHistoryModal('actions')" title="View All">
                        <span class="mdi mdi-arrow-expand"></span>
                    </button>
                </div>
                <div class="history-log" id="action-history">
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Loading history...</span>
                    </div>
                </div>
            </div>

            <!-- State History Timeline - with relative time and modal -->
            <div class="card glass-effect history-card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="icon mdi mdi-timeline-clock"></span>
                        State Timeline
                    </span>
                    <button class="btn btn-icon btn-sm" onclick="openHistoryModal('states')" title="View All">
                        <span class="mdi mdi-arrow-expand"></span>
                    </button>
                </div>
                <div class="timeline" id="state-history">
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Loading timeline...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>CWU Controller v3.0.0 | Last update: <span id="last-update">--</span></p>
        </footer>
    </div>

    <!-- Fullscreen Chart Modal -->
    <div class="modal" id="chart-modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <h3 id="chart-modal-title">Chart</h3>
                <div class="modal-controls">
                    <button class="btn btn-sm" onclick="updateModalChartRange('1h')">1H</button>
                    <button class="btn btn-sm" onclick="updateModalChartRange('6h')">6H</button>
                    <button class="btn btn-sm active" onclick="updateModalChartRange('24h')" id="modal-24h-btn">24H</button>
                    <button class="btn btn-sm" onclick="updateModalChartRange('48h')">48H</button>
                    <button class="btn btn-sm" onclick="updateModalChartRange('7d')">7D</button>
                    <button class="btn btn-icon" onclick="closeModal('chart-modal')">
                        <span class="mdi mdi-close"></span>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="chart-container-fullscreen">
                    <canvas id="modalChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="history-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="history-modal-title">History</h3>
                <button class="btn btn-icon" onclick="closeModal('history-modal')">
                    <span class="mdi mdi-close"></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="history-full" id="history-modal-content">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mode Selection Modal -->
    <div class="modal" id="mode-modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="mode-modal-title">Select Duration</h3>
                <button class="btn btn-icon" onclick="closeModal('mode-modal')">
                    <span class="mdi mdi-close"></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="mode-modal-icon" id="mode-modal-icon">
                    <span class="mdi mdi-water-boiler"></span>
                </div>

                <!-- Tabs for CWU -->
                <div class="mode-tabs" id="mode-tabs-cwu">
                    <button class="mode-tab active" id="tab-duration-cwu" onclick="switchModeTab('duration')">
                        <span class="mdi mdi-timer-outline"></span> Duration
                    </button>
                    <button class="mode-tab" id="tab-heat-to" onclick="switchModeTab('heat-to')">
                        <span class="mdi mdi-target"></span> Heat to °C
                    </button>
                </div>

                <!-- Tabs for Floor -->
                <div class="mode-tabs" id="mode-tabs-floor" style="display: none;">
                    <button class="mode-tab active" id="tab-duration-floor" onclick="switchModeTab('duration')">
                        <span class="mdi mdi-timer-outline"></span> Force
                    </button>
                    <button class="mode-tab" id="tab-boost" onclick="switchModeTab('boost')">
                        <span class="mdi mdi-radiator"></span> Boost 28°C
                    </button>
                    <button class="mode-tab" id="tab-floor-temp" onclick="switchModeTab('floor-temp')">
                        <span class="mdi mdi-thermometer"></span> Set °C
                    </button>
                </div>

                <!-- Duration Panel -->
                <div class="mode-panel" id="panel-duration">
                    <p class="mode-modal-description" id="mode-modal-description">Force CWU heating for:</p>
                    <div class="duration-slider-container">
                        <input type="range" id="duration-slider" min="1" max="12" step="0.5" value="3"
                               oninput="updateDurationDisplay()">
                        <div class="duration-display">
                            <span class="duration-value" id="duration-value">3</span>
                            <span class="duration-unit">hours</span>
                        </div>
                    </div>
                    <div class="duration-presets">
                        <button class="preset-btn" onclick="setDuration(1)">1h</button>
                        <button class="preset-btn" onclick="setDuration(2)">2h</button>
                        <button class="preset-btn active" onclick="setDuration(3)">3h</button>
                        <button class="preset-btn" onclick="setDuration(6)">6h</button>
                        <button class="preset-btn" onclick="setDuration(12)">12h</button>
                    </div>
                </div>

                <!-- Heat-to Panel (CWU only) -->
                <div class="mode-panel" id="panel-heat-to" style="display: none;">
                    <p class="mode-modal-description">Heat CWU to target temperature, then return to AUTO:</p>
                    <div class="heat-to-input-group">
                        <input type="number" id="heat-to-temp" class="heat-to-input" value="50" min="36" max="55" step="1">
                        <span class="heat-to-unit">°C</span>
                    </div>
                    <div class="heat-to-presets">
                        <button class="preset-btn" onclick="setHeatToTemp(40)">40°C</button>
                        <button class="preset-btn" onclick="setHeatToTemp(45)">45°C</button>
                        <button class="preset-btn active" onclick="setHeatToTemp(50)">50°C</button>
                        <button class="preset-btn" onclick="setHeatToTemp(55)">55°C</button>
                    </div>
                </div>

                <!-- Heat-to progress (shown when active) -->
                <div class="heat-to-progress" id="heat-to-progress" style="display: none;">
                    <div class="heat-to-progress-bar">
                        <div class="heat-to-progress-fill" id="heat-to-progress-fill"></div>
                    </div>
                    <span class="heat-to-progress-text" id="heat-to-progress-text">--°C / --°C</span>
                </div>

                <!-- Floor Boost Panel -->
                <div class="mode-panel" id="panel-boost" style="display: none;">
                    <p class="mode-modal-description">Raise floor temp to 28°C:</p>
                    <div class="boost-options">
                        <div class="boost-option">
                            <label class="boost-label">Duration (hours):</label>
                            <div class="duration-slider-container">
                                <input type="range" id="boost-duration-slider" min="1" max="8" step="1" value="2"
                                       oninput="updateBoostDurationDisplay()">
                                <div class="duration-display">
                                    <span class="duration-value" id="boost-duration-value">2</span>
                                    <span class="duration-unit">h</span>
                                </div>
                            </div>
                            <div class="duration-presets boost-presets">
                                <button class="preset-btn" onclick="setBoostDuration(1)">1h</button>
                                <button class="preset-btn active" onclick="setBoostDuration(2)">2h</button>
                                <button class="preset-btn" onclick="setBoostDuration(3)">3h</button>
                                <button class="preset-btn" onclick="setBoostDuration(4)">4h</button>
                                <button class="preset-btn" onclick="setBoostDuration(6)">6h</button>
                                <button class="preset-btn" onclick="setBoostDuration(8)">8h</button>
                            </div>
                            <button class="btn btn-primary" onclick="confirmBoostDuration()">
                                <span class="mdi mdi-radiator"></span>
                                Start Boost
                            </button>
                        </div>
                        <div class="boost-divider">
                            <span>or</span>
                        </div>
                        <button class="btn btn-secondary btn-session" id="boost-session-btn" onclick="confirmBoostSession()">
                            <span class="mdi mdi-timer-sand"></span>
                            Until Session Ends
                        </button>
                    </div>
                    <div class="boost-status" id="boost-status" style="display: none;">
                        <span class="mdi mdi-radiator"></span>
                        <span id="boost-status-text">Boost active</span>
                    </div>
                </div>

                <!-- Floor Set Temperature Panel -->
                <div class="mode-panel" id="panel-floor-temp" style="display: none;">
                    <p class="mode-modal-description">Set floor target temperature:</p>
                    <div class="floor-temp-container">
                        <div class="floor-temp-current" id="floor-temp-current">
                            Current: <span id="floor-temp-current-value">--</span>°C
                        </div>
                        <div class="duration-slider-container">
                            <input type="range" id="floor-temp-slider" min="15" max="28" step="0.5" value="21"
                                   oninput="updateFloorTempDisplay()">
                            <div class="duration-display">
                                <span class="duration-value" id="floor-temp-value">21</span>
                                <span class="duration-unit">°C</span>
                            </div>
                        </div>
                        <div class="duration-presets floor-temp-presets">
                            <button class="preset-btn" onclick="setFloorTemp(18)">18°C</button>
                            <button class="preset-btn" onclick="setFloorTemp(20)">20°C</button>
                            <button class="preset-btn active" onclick="setFloorTemp(21)">21°C</button>
                            <button class="preset-btn" onclick="setFloorTemp(22)">22°C</button>
                            <button class="preset-btn" onclick="setFloorTemp(24)">24°C</button>
                        </div>
                        <button class="btn btn-primary" onclick="confirmFloorTemp()">
                            <span class="mdi mdi-thermometer"></span>
                            Set Temperature
                        </button>
                    </div>
                </div>

                <button class="btn btn-primary btn-block" id="mode-confirm-btn" onclick="confirmMode()">
                    <span class="mdi mdi-check"></span>
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script src="panel.js?v=9.1.0"></script>
</body>
</html>
