{# --- CWU Controller Widget (Compact) --- #}
{% set state = states('sensor.cwu_controller_state') %}
{% set cwu_temp = states('sensor.cwu_controller_bsb_cwu_temperature') | float(0) %}
{% set outside = states('sensor.cwu_controller_bsb_outside_temperature') | float(0) %}
{% set power = states('sensor.cwu_controller_average_power') | float(0) %}
{% set is_cheap = state_attr('sensor.cwu_controller_tariff_rate', 'is_cheap_tariff') %}
{% set hold = state_attr('sensor.cwu_controller_state', 'hold_time_remaining') | default(0) %}

{# Status #}
{% if state == 'heating_cwu' %}ğŸ”¥CWU{% elif state == 'heating_floor' %}ğŸ FLOOR{% elif 'emergency' in state %}ğŸš¨EMG{% elif state == 'pause' %}â¸ï¸PAUZA{% elif state == 'fake_heating_detected' %}âš ï¸FAKE{% else %}ğŸ’¤IDLE{% endif %}
{% if hold > 0 %} ({{ hold }}m){% endif %}

<br>
ğŸŒ¡ï¸ {{ cwu_temp | round(1) }}Â°C | ğŸŒ {{ outside | round(1) }}Â°C
<br>
âš¡ {{ power | round(0) }}W | {% if is_cheap %}ğŸ’šTania{% else %}â›”Droga{% endif %}
<br>
<em>{{ now().strftime('%H:%M') }}</em>
