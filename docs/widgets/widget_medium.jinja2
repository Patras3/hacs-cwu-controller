{# --- CWU Controller Widget (Medium/BSB) --- #}
{% set state = states('sensor.cwu_controller_state') %}
{% set cwu = states('sensor.cwu_controller_bsb_cwu_temperature') | float(0) %}
{% set cwu_mode = states('sensor.cwu_controller_bsb_cwu_mode') %}
{% set floor_mode = states('sensor.cwu_controller_bsb_floor_mode') %}
{% set dhw = states('sensor.cwu_controller_bsb_dhw_status') %}
{% set hp = states('sensor.cwu_controller_bsb_heat_pump_status') %}
{% set power = states('sensor.cwu_controller_average_power') | float(0) %}
{% set hold = state_attr('sensor.cwu_controller_state', 'hold_time_remaining') | default(0) %}
{% set hp_ready = state_attr('sensor.cwu_controller_state', 'hp_ready') | default(true) %}

{# NagÅ‚Ã³wek #}
<b>CWU Controller</b>
<br><br>

{# Stan + Hold #}
{% if state == 'heating_cwu' %}
ğŸ”¥ <span style="color:#00BCD4;font-size:20px;">Grzanie CWU</span>
{% elif state == 'heating_floor' %}
ğŸ  <span style="color:#4CAF50;font-size:20px;">PodÅ‚ogÃ³wka</span>
{% elif state == 'emergency_cwu' or state == 'emergency_floor' %}
ğŸš¨ <span style="color:#F44336;font-size:20px;">EMERGENCY!</span>
{% elif state == 'pause' %}
â¸ï¸ <span style="color:#FF9800;font-size:20px;">Pauza</span>
{% elif state == 'fake_heating_detected' %}
âš ï¸ <span style="color:#FF5722;font-size:20px;">Fake Heat</span>
{% else %}
ğŸ’¤ <span style="color:#607D8B;font-size:20px;">Idle</span>
{% endif %}
{% if hold > 0 %} <span style="color:#FF9800;">({{ hold }}m)</span>{% endif %}

<br><br>

{# Temperatury #}
ğŸŒ¡ï¸ CWU: {% if cwu < 38 %}<span style="color:#F44336;">{% elif cwu < 42 %}<span style="color:#FF9800;">{% else %}<span style="color:#4CAF50;">{% endif %}<b>{{ cwu | round(1) }}Â°C</b></span>
<br>
âš¡ {{ power | round(0) }}W

<br><br>

{# BSB Status #}
ğŸ“¡ <b>BSB:</b><br>
CWU: {% if cwu_mode | lower in ['on','eco','1'] %}ğŸŸ¢{% else %}âš«{% endif %} {{ cwu_mode }}
 | Floor: {% if floor_mode | lower in ['automatic','comfort','1'] %}ğŸŸ¢{% else %}âš«{% endif %} {{ floor_mode }}
<br>
DHW: {{ dhw }}<br>
HP: {{ hp }}
<br>
{% if hp_ready %}âœ… Ready{% else %}â³ Waiting{% endif %}

<br><br>
<em style="color:#888;">{{ now().strftime('%H:%M:%S') }}</em>
